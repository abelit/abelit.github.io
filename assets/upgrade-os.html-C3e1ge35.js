import{_ as e}from"./plugin-vue_export-helper-DlAUqK2U.js";import{o as a,c as s,f as n}from"./app-C7nDDXNs.js";const l={},i=n(`<h2 id="升级前准备" tabindex="-1"><a class="header-anchor" href="#升级前准备"><span>升级前准备</span></a></h2><h3 id="升级信息" tabindex="-1"><a class="header-anchor" href="#升级信息"><span>升级信息</span></a></h3><p>本次升级由 <code>CentOS 7.x</code> 升级到 <code>Rocky Linux 8.10</code>。</p><p><code>Rocky Linux 8.10</code> 的<code>维护支持</code>直到 2029 年 5 月底，<code>延长生命周期支持</code>到 2032 年 5 月底。</p><h3 id="确定系统版本" tabindex="-1"><a class="header-anchor" href="#确定系统版本"><span>确定系统版本</span></a></h3><blockquote><p>确保升级到CentOS 7.9 最新版本</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">cat</span> /etc/redhat-release
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="腾空节点" tabindex="-1"><a class="header-anchor" href="#腾空节点"><span>腾空节点</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>kubectl drain k8s-worker02 --ignore-daemonsets
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="移除repo" tabindex="-1"><a class="header-anchor" href="#移除repo"><span>移除repo</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/yum.repos.d/backup/
<span class="token comment"># mv /etc/yum.repos.d/kubernetes.repo /etc/yum.repos.d/backup/</span>
<span class="token function">mv</span> /etc/yum.repos.d/*.repo /etc/yum.repos.d/backup/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>###　安装　<code>epel</code> 源</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># yum -y install epel-release</span>
<span class="token function">wget</span> <span class="token parameter variable">-O</span> /etc/yum.repos.d/epel.repo https://mirrors.aliyun.com/repo/epel-7.repo

<span class="token function">wget</span> <span class="token parameter variable">-O</span> /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="检查需更新软件包" tabindex="-1"><a class="header-anchor" href="#检查需更新软件包"><span>检查需更新软件包</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>yum check-update
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="包管理器清理" tabindex="-1"><a class="header-anchor" href="#包管理器清理"><span>包管理器清理</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>yum clean all
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="更新-centos" tabindex="-1"><a class="header-anchor" href="#更新-centos"><span>更新 CentOS</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>yum update 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="重启系统" tabindex="-1"><a class="header-anchor" href="#重启系统"><span>重启系统</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">reboot</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="开始升级" tabindex="-1"><a class="header-anchor" href="#开始升级"><span>开始升级</span></a></h2><h3 id="安装-elevate-release-包" tabindex="-1"><a class="header-anchor" href="#安装-elevate-release-包"><span>安装 <code>elevate-release</code> 包</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>yum <span class="token function">install</span> <span class="token parameter variable">-y</span> http://repo.almalinux.org/elevate/elevate-release-latest-el<span class="token variable"><span class="token variable">$(</span><span class="token function">rpm</span> <span class="token parameter variable">--eval</span> %rhel<span class="token variable">)</span></span>.noarch.rpm
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="安装-leapp-data-rocky-数据迁移包" tabindex="-1"><a class="header-anchor" href="#安装-leapp-data-rocky-数据迁移包"><span>安装 <code>leapp-data-rocky</code> 数据迁移包</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>yum <span class="token function">install</span> <span class="token parameter variable">-y</span> leapp-upgrade leapp-data-rocky
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>###　迁移升级检查</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>leapp preupgrade
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">提示</p><p>检查报告 /var/log/leapp/leapp-report.txt 文件</p><p>这部分是最容易会出现红色的错误提示。比较多的问题是由于原centos7的软件包同新系统的冲突或升级检查条件不满足等，均会卡在这里。基本处理思路先删除冲突的软件包，在升级完系统后再安装回来。（可以参考后续错误提示例子解决问题）</p><p>如果有异常,需要处理完异常后再次运行升级检查,直到检查通过后才执行升级.</p></div><h3 id="确认leapp默认回答" tabindex="-1"><a class="header-anchor" href="#确认leapp默认回答"><span>确认Leapp默认回答</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>leapp answer <span class="token parameter variable">--section</span> <span class="token assign-left variable">remove_pam_pkcs11_module_check.confirm</span><span class="token operator">=</span>True
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">提示</p><p>出现绿色Report提示, 才继续下一步升级迁移，否则先处理完错误.</p></div><h3 id="开始迁移至-rocky-linux8" tabindex="-1"><a class="header-anchor" href="#开始迁移至-rocky-linux8"><span>开始迁移至 Rocky Linux8</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>leapp upgrade 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="重启" tabindex="-1"><a class="header-anchor" href="#重启"><span>重启</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">reboot</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="检查版本" tabindex="-1"><a class="header-anchor" href="#检查版本"><span>检查版本</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">cat</span> /etc/redhat-release
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="迁移后检查" tabindex="-1"><a class="header-anchor" href="#迁移后检查"><span>迁移后检查</span></a></h3><ul><li>迁移后，首先安装回之前由于解决软件包冲突删除的软件（上面导致红色错误的软件包）。</li><li>再次检查迁移后的报告 <code>/var/log/leapp/leapp-report.txt</code> 文件,了解迁移软件的升级提示。</li><li>检查相关的软件，留意部分软件包将随系统版本升级的过程中，一并更新了版本，检查相关的升级对系统原软件的兼容情况。 最后恭喜你，到达这里已经所有的升级折腾已过。至此系统升级到 <code>Rocky Linux 8</code>，完成所有的升级。</li></ul><h3 id="问题及处理" tabindex="-1"><a class="header-anchor" href="#问题及处理"><span>问题及处理</span></a></h3><ul><li>openssl11-libs异常</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>yum erase openssl11-libs 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">提示</p><p>Openssl-libs异常是由于在centos7中存使用yum管理安装包，它允许openssl-libs存在多个版本，当升级到rockylinux8后，改为dnf进行包管理它不再允许相同的软件包存在多个版本，对应这情况先删除掉在7.8中的特有版本，在继续迁移。</p></div><ul><li>Python支持版本</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>alternatives <span class="token parameter variable">--set</span> python /usr/bin/python3 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">提示</p><p>在切换到rockylinux8后，由于新版系统没有默认的python命令，它提供了主流的python 3与有限支持的python 2版本，可以通过alternatives命令进行python版本切换。建议使用下面的命令进行切换（留意Python 3不Python 2完全向下兼容，需要检查对原有的python代码是否有影响。）。</p></div><h3 id="解除节点的保护" tabindex="-1"><a class="header-anchor" href="#解除节点的保护"><span>解除节点的保护</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>kubectl uncordon k8s-worker02
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,49),t=[i];function d(r,c){return a(),s("div",null,t)}const h=e(l,[["render",d],["__file","upgrade-os.html.vue"]]),u=JSON.parse('{"path":"/guide/cloudnative/kubernetes/installation/upgrade-os.html","title":"Kubernetes宿主机系统升级","lang":"zh-CN","frontmatter":{"title":"Kubernetes宿主机系统升级","description":"升级前准备 升级信息 本次升级由 CentOS 7.x 升级到 Rocky Linux 8.10。 Rocky Linux 8.10 的维护支持直到 2029 年 5 月底，延长生命周期支持到 2032 年 5 月底。 确定系统版本 确保升级到CentOS 7.9 最新版本 腾空节点 移除repo ### 安装 epel 源 检查需更新软件包 包管理器...","head":[["meta",{"property":"og:url","content":"https://github.com/abelit/abelit-datapeacock.git/guide/cloudnative/kubernetes/installation/upgrade-os.html"}],["meta",{"property":"og:site_name","content":"数之雀"}],["meta",{"property":"og:title","content":"Kubernetes宿主机系统升级"}],["meta",{"property":"og:description","content":"升级前准备 升级信息 本次升级由 CentOS 7.x 升级到 Rocky Linux 8.10。 Rocky Linux 8.10 的维护支持直到 2029 年 5 月底，延长生命周期支持到 2032 年 5 月底。 确定系统版本 确保升级到CentOS 7.9 最新版本 腾空节点 移除repo ### 安装 epel 源 检查需更新软件包 包管理器..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-08-03T08:57:34.000Z"}],["meta",{"property":"article:author","content":"Abelit"}],["meta",{"property":"article:modified_time","content":"2024-08-03T08:57:34.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Kubernetes宿主机系统升级\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-08-03T08:57:34.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Abelit\\",\\"url\\":\\"https://github.com/abelit\\"}]}"]]},"headers":[{"level":2,"title":"升级前准备","slug":"升级前准备","link":"#升级前准备","children":[{"level":3,"title":"升级信息","slug":"升级信息","link":"#升级信息","children":[]},{"level":3,"title":"确定系统版本","slug":"确定系统版本","link":"#确定系统版本","children":[]},{"level":3,"title":"腾空节点","slug":"腾空节点","link":"#腾空节点","children":[]},{"level":3,"title":"移除repo","slug":"移除repo","link":"#移除repo","children":[]},{"level":3,"title":"检查需更新软件包","slug":"检查需更新软件包","link":"#检查需更新软件包","children":[]},{"level":3,"title":"包管理器清理","slug":"包管理器清理","link":"#包管理器清理","children":[]},{"level":3,"title":"更新 CentOS","slug":"更新-centos","link":"#更新-centos","children":[]},{"level":3,"title":"重启系统","slug":"重启系统","link":"#重启系统","children":[]}]},{"level":2,"title":"开始升级","slug":"开始升级","link":"#开始升级","children":[{"level":3,"title":"安装 elevate-release 包","slug":"安装-elevate-release-包","link":"#安装-elevate-release-包","children":[]},{"level":3,"title":"安装 leapp-data-rocky 数据迁移包","slug":"安装-leapp-data-rocky-数据迁移包","link":"#安装-leapp-data-rocky-数据迁移包","children":[]},{"level":3,"title":"确认Leapp默认回答","slug":"确认leapp默认回答","link":"#确认leapp默认回答","children":[]},{"level":3,"title":"开始迁移至 Rocky Linux8","slug":"开始迁移至-rocky-linux8","link":"#开始迁移至-rocky-linux8","children":[]},{"level":3,"title":"重启","slug":"重启","link":"#重启","children":[]},{"level":3,"title":"检查版本","slug":"检查版本","link":"#检查版本","children":[]},{"level":3,"title":"迁移后检查","slug":"迁移后检查","link":"#迁移后检查","children":[]},{"level":3,"title":"问题及处理","slug":"问题及处理","link":"#问题及处理","children":[]},{"level":3,"title":"解除节点的保护","slug":"解除节点的保护","link":"#解除节点的保护","children":[]}]}],"git":{"createdTime":1722675454000,"updatedTime":1722675454000,"contributors":[{"name":"abelit","email":"ychenid@live.com","commits":1}]},"readingTime":{"minutes":2.62,"words":787},"filePathRelative":"guide/cloudnative/kubernetes/installation/upgrade-os.md","localizedDate":"2024年8月3日","autoDesc":true,"excerpt":"<h2>升级前准备</h2>\\n<h3>升级信息</h3>\\n<p>本次升级由 <code>CentOS 7.x</code> 升级到 <code>Rocky Linux 8.10</code>。</p>\\n<p><code>Rocky Linux 8.10</code> 的<code>维护支持</code>直到 2029 年 5 月底，<code>延长生命周期支持</code>到 2032 年 5 月底。</p>\\n<h3>确定系统版本</h3>\\n<blockquote>\\n<p>确保升级到CentOS 7.9 最新版本</p>\\n</blockquote>\\n<div class=\\"language-bash\\" data-ext=\\"sh\\" data-title=\\"sh\\"><pre class=\\"language-bash\\"><code><span class=\\"token function\\">cat</span> /etc/redhat-release\\n</code></pre></div>"}');export{h as comp,u as data};
