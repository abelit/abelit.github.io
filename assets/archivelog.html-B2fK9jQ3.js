import{_ as o}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as c,o as l,c as i,b as u,w as a,f as k,d as s,a as n}from"./app-C7nDDXNs.js";const r={},d=k(`<h2 id="日志查询" tabindex="-1"><a class="header-anchor" href="#日志查询"><span>日志查询</span></a></h2><h3 id="日志切换数量查询" tabindex="-1"><a class="header-anchor" href="#日志切换数量查询"><span>日志切换数量查询</span></a></h3><ul><li>按日期汇总每天的归档日志数量</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> TRUNC<span class="token punctuation">(</span>completion_time<span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token string">&quot;日期&quot;</span><span class="token punctuation">,</span>
       <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token string">&quot;数量&quot;</span><span class="token punctuation">,</span>
       <span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span>blocks <span class="token operator">*</span> block_size<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token string">&quot;MB&quot;</span>
<span class="token keyword">FROM</span> v$archived_log
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> TRUNC<span class="token punctuation">(</span>completion_time<span class="token punctuation">)</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> TRUNC<span class="token punctuation">(</span>completion_time<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>按小时汇总当天的归档日志数量</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">SESSION</span> <span class="token keyword">SET</span> NLS_DATE_FORMAT<span class="token operator">=</span><span class="token string">&#39;yyyy.mm.dd hh24:mi:ss&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> TRUNC<span class="token punctuation">(</span>first_time<span class="token punctuation">,</span> <span class="token string">&#39;hh&#39;</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token string">&quot;时间&quot;</span><span class="token punctuation">,</span>
       <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token string">&quot;数量&quot;</span><span class="token punctuation">,</span>
       <span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span>blocks <span class="token operator">*</span> block_size<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token string">&quot;MB&quot;</span>
<span class="token keyword">FROM</span> v$archived_log
<span class="token keyword">WHERE</span> DEST_ID <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">AND</span> FIRST_TIME <span class="token operator">&gt;</span> TRUNC<span class="token punctuation">(</span>SYSDATE<span class="token punctuation">)</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> TRUNC<span class="token punctuation">(</span>first_time<span class="token punctuation">,</span> <span class="token string">&#39;hh&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> TRUNC<span class="token punctuation">(</span>first_time<span class="token punctuation">,</span> <span class="token string">&#39;hh&#39;</span><span class="token punctuation">)</span> <span class="token keyword">DESC</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="产生大量日志的sql追踪" tabindex="-1"><a class="header-anchor" href="#产生大量日志的sql追踪"><span>产生大量日志的SQL追踪</span></a></h3><ul><li>每天redo log的切换次数</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token comment">/******统计每天redo log的切换次数汇总,以及与平均次数的对比*****/</span>
<span class="token keyword">WITH</span> T <span class="token keyword">AS</span> 
<span class="token punctuation">(</span>
    <span class="token keyword">SELECT</span> TO_CHAR<span class="token punctuation">(</span>FIRST_TIME<span class="token punctuation">,</span> <span class="token string">&#39;YYYY-MM-DD&#39;</span><span class="token punctuation">)</span>    <span class="token keyword">AS</span> LOG_GEN_DAY<span class="token punctuation">,</span> 
           TO_CHAR<span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span>DECODE<span class="token punctuation">(</span>TO_CHAR<span class="token punctuation">(</span>FIRST_TIME<span class="token punctuation">,</span> <span class="token string">&#39;YYYY-MM-DD&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
                       TO_CHAR<span class="token punctuation">(</span>FIRST_TIME<span class="token punctuation">,</span> <span class="token string">&#39;YYYY-MM-DD&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">,</span> <span class="token string">&#39;99999&#39;</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token string">&quot;LOG_SWITCH_NUM&quot;</span> 
    <span class="token keyword">FROM</span>   V$LOG_HISTORY 
  <span class="token comment">-- WHERE FIRST_TIME &lt; TRUNC(SYSDATE)  --排除当前这一天</span>
    <span class="token keyword">GROUP</span>  <span class="token keyword">BY</span> TO_CHAR<span class="token punctuation">(</span>FIRST_TIME<span class="token punctuation">,</span> <span class="token string">&#39;YYYY-MM-DD&#39;</span><span class="token punctuation">)</span> 
<span class="token punctuation">)</span>
<span class="token keyword">SELECT</span>  T<span class="token punctuation">.</span>LOG_GEN_DAY
          <span class="token punctuation">,</span> T<span class="token punctuation">.</span>LOG_SWITCH_NUM
          <span class="token punctuation">,</span> M<span class="token punctuation">.</span>AVG_LOG_SWITCH_NUM
      <span class="token punctuation">,</span> <span class="token punctuation">(</span>T<span class="token punctuation">.</span>LOG_SWITCH_NUM<span class="token operator">-</span>M<span class="token punctuation">.</span>AVG_LOG_SWITCH_NUM<span class="token punctuation">)</span> <span class="token keyword">AS</span> DIFF_SWITCH_NUM
<span class="token keyword">FROM</span>  T <span class="token keyword">CROSS</span> <span class="token keyword">JOIN</span> 
<span class="token punctuation">(</span>
    <span class="token keyword">SELECT</span>  TO_CHAR<span class="token punctuation">(</span><span class="token function">AVG</span><span class="token punctuation">(</span>T<span class="token punctuation">.</span>LOG_SWITCH_NUM<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;999&#39;</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> AVG_LOG_SWITCH_NUM
    <span class="token keyword">FROM</span> T
<span class="token punctuation">)</span> M
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> T<span class="token punctuation">.</span>LOG_GEN_DAY <span class="token keyword">DESC</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>每小时日志切换次数</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span>    TO_CHAR<span class="token punctuation">(</span>FIRST_TIME<span class="token punctuation">,</span><span class="token string">&#39;YYYY-MM-DD&#39;</span><span class="token punctuation">)</span> <span class="token keyword">DAY</span><span class="token punctuation">,</span>
                TO_CHAR<span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span>DECODE<span class="token punctuation">(</span>TO_CHAR<span class="token punctuation">(</span>FIRST_TIME<span class="token punctuation">,</span><span class="token string">&#39;HH24&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;00&#39;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;999&#39;</span><span class="token punctuation">)</span> <span class="token string">&quot;00&quot;</span><span class="token punctuation">,</span>
                TO_CHAR<span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span>DECODE<span class="token punctuation">(</span>TO_CHAR<span class="token punctuation">(</span>FIRST_TIME<span class="token punctuation">,</span><span class="token string">&#39;HH24&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;01&#39;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;999&#39;</span><span class="token punctuation">)</span> <span class="token string">&quot;01&quot;</span><span class="token punctuation">,</span>
                TO_CHAR<span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span>DECODE<span class="token punctuation">(</span>TO_CHAR<span class="token punctuation">(</span>FIRST_TIME<span class="token punctuation">,</span><span class="token string">&#39;HH24&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;02&#39;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;999&#39;</span><span class="token punctuation">)</span> <span class="token string">&quot;02&quot;</span><span class="token punctuation">,</span>
                TO_CHAR<span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span>DECODE<span class="token punctuation">(</span>TO_CHAR<span class="token punctuation">(</span>FIRST_TIME<span class="token punctuation">,</span><span class="token string">&#39;HH24&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;03&#39;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;999&#39;</span><span class="token punctuation">)</span> <span class="token string">&quot;03&quot;</span><span class="token punctuation">,</span>
                TO_CHAR<span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span>DECODE<span class="token punctuation">(</span>TO_CHAR<span class="token punctuation">(</span>FIRST_TIME<span class="token punctuation">,</span><span class="token string">&#39;HH24&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;04&#39;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;999&#39;</span><span class="token punctuation">)</span> <span class="token string">&quot;04&quot;</span><span class="token punctuation">,</span>
                TO_CHAR<span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span>DECODE<span class="token punctuation">(</span>TO_CHAR<span class="token punctuation">(</span>FIRST_TIME<span class="token punctuation">,</span><span class="token string">&#39;HH24&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;05&#39;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;999&#39;</span><span class="token punctuation">)</span> <span class="token string">&quot;05&quot;</span><span class="token punctuation">,</span>
                TO_CHAR<span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span>DECODE<span class="token punctuation">(</span>TO_CHAR<span class="token punctuation">(</span>FIRST_TIME<span class="token punctuation">,</span><span class="token string">&#39;HH24&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;06&#39;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;999&#39;</span><span class="token punctuation">)</span> <span class="token string">&quot;06&quot;</span><span class="token punctuation">,</span>
                TO_CHAR<span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span>DECODE<span class="token punctuation">(</span>TO_CHAR<span class="token punctuation">(</span>FIRST_TIME<span class="token punctuation">,</span><span class="token string">&#39;HH24&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;07&#39;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;999&#39;</span><span class="token punctuation">)</span> <span class="token string">&quot;07&quot;</span><span class="token punctuation">,</span>
                TO_CHAR<span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span>DECODE<span class="token punctuation">(</span>TO_CHAR<span class="token punctuation">(</span>FIRST_TIME<span class="token punctuation">,</span><span class="token string">&#39;HH24&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;08&#39;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;999&#39;</span><span class="token punctuation">)</span> <span class="token string">&quot;08&quot;</span><span class="token punctuation">,</span>
                TO_CHAR<span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span>DECODE<span class="token punctuation">(</span>TO_CHAR<span class="token punctuation">(</span>FIRST_TIME<span class="token punctuation">,</span><span class="token string">&#39;HH24&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;09&#39;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;999&#39;</span><span class="token punctuation">)</span> <span class="token string">&quot;09&quot;</span><span class="token punctuation">,</span>
                TO_CHAR<span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span>DECODE<span class="token punctuation">(</span>TO_CHAR<span class="token punctuation">(</span>FIRST_TIME<span class="token punctuation">,</span><span class="token string">&#39;HH24&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;10&#39;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;999&#39;</span><span class="token punctuation">)</span> <span class="token string">&quot;10&quot;</span><span class="token punctuation">,</span>
                TO_CHAR<span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span>DECODE<span class="token punctuation">(</span>TO_CHAR<span class="token punctuation">(</span>FIRST_TIME<span class="token punctuation">,</span><span class="token string">&#39;HH24&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;11&#39;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;999&#39;</span><span class="token punctuation">)</span> <span class="token string">&quot;11&quot;</span><span class="token punctuation">,</span>
                TO_CHAR<span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span>DECODE<span class="token punctuation">(</span>TO_CHAR<span class="token punctuation">(</span>FIRST_TIME<span class="token punctuation">,</span><span class="token string">&#39;HH24&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;12&#39;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;999&#39;</span><span class="token punctuation">)</span> <span class="token string">&quot;12&quot;</span><span class="token punctuation">,</span>
                TO_CHAR<span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span>DECODE<span class="token punctuation">(</span>TO_CHAR<span class="token punctuation">(</span>FIRST_TIME<span class="token punctuation">,</span><span class="token string">&#39;HH24&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;13&#39;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;999&#39;</span><span class="token punctuation">)</span> <span class="token string">&quot;13&quot;</span><span class="token punctuation">,</span>
                TO_CHAR<span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span>DECODE<span class="token punctuation">(</span>TO_CHAR<span class="token punctuation">(</span>FIRST_TIME<span class="token punctuation">,</span><span class="token string">&#39;HH24&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;14&#39;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;999&#39;</span><span class="token punctuation">)</span> <span class="token string">&quot;14&quot;</span><span class="token punctuation">,</span>
                TO_CHAR<span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span>DECODE<span class="token punctuation">(</span>TO_CHAR<span class="token punctuation">(</span>FIRST_TIME<span class="token punctuation">,</span><span class="token string">&#39;HH24&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;15&#39;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;999&#39;</span><span class="token punctuation">)</span> <span class="token string">&quot;15&quot;</span><span class="token punctuation">,</span>
                TO_CHAR<span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span>DECODE<span class="token punctuation">(</span>TO_CHAR<span class="token punctuation">(</span>FIRST_TIME<span class="token punctuation">,</span><span class="token string">&#39;HH24&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;16&#39;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;999&#39;</span><span class="token punctuation">)</span> <span class="token string">&quot;16&quot;</span><span class="token punctuation">,</span>
                TO_CHAR<span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span>DECODE<span class="token punctuation">(</span>TO_CHAR<span class="token punctuation">(</span>FIRST_TIME<span class="token punctuation">,</span><span class="token string">&#39;HH24&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;17&#39;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;999&#39;</span><span class="token punctuation">)</span> <span class="token string">&quot;17&quot;</span><span class="token punctuation">,</span>
                TO_CHAR<span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span>DECODE<span class="token punctuation">(</span>TO_CHAR<span class="token punctuation">(</span>FIRST_TIME<span class="token punctuation">,</span><span class="token string">&#39;HH24&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;18&#39;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;999&#39;</span><span class="token punctuation">)</span> <span class="token string">&quot;18&quot;</span><span class="token punctuation">,</span>
                TO_CHAR<span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span>DECODE<span class="token punctuation">(</span>TO_CHAR<span class="token punctuation">(</span>FIRST_TIME<span class="token punctuation">,</span><span class="token string">&#39;HH24&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;19&#39;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;999&#39;</span><span class="token punctuation">)</span> <span class="token string">&quot;19&quot;</span><span class="token punctuation">,</span>
                TO_CHAR<span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span>DECODE<span class="token punctuation">(</span>TO_CHAR<span class="token punctuation">(</span>FIRST_TIME<span class="token punctuation">,</span><span class="token string">&#39;HH24&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;20&#39;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;999&#39;</span><span class="token punctuation">)</span> <span class="token string">&quot;20&quot;</span><span class="token punctuation">,</span>
                TO_CHAR<span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span>DECODE<span class="token punctuation">(</span>TO_CHAR<span class="token punctuation">(</span>FIRST_TIME<span class="token punctuation">,</span><span class="token string">&#39;HH24&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;21&#39;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;999&#39;</span><span class="token punctuation">)</span> <span class="token string">&quot;21&quot;</span><span class="token punctuation">,</span>
                TO_CHAR<span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span>DECODE<span class="token punctuation">(</span>TO_CHAR<span class="token punctuation">(</span>FIRST_TIME<span class="token punctuation">,</span><span class="token string">&#39;HH24&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;22&#39;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;999&#39;</span><span class="token punctuation">)</span> <span class="token string">&quot;22&quot;</span><span class="token punctuation">,</span>
                TO_CHAR<span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span>DECODE<span class="token punctuation">(</span>TO_CHAR<span class="token punctuation">(</span>FIRST_TIME<span class="token punctuation">,</span><span class="token string">&#39;HH24&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;23&#39;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;999&#39;</span><span class="token punctuation">)</span> <span class="token string">&quot;23&quot;</span>
<span class="token keyword">FROM</span> V$LOG_HISTORY
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> TO_CHAR<span class="token punctuation">(</span>FIRST_TIME<span class="token punctuation">,</span><span class="token string">&#39;YYYY-MM-DD&#39;</span><span class="token punctuation">)</span> 
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token number">1</span> <span class="token keyword">DESC</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="归档日志清理" tabindex="-1"><a class="header-anchor" href="#归档日志清理"><span>归档日志清理</span></a></h2><ul><li>清理日志</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code>rman log<span class="token operator">=</span><span class="token operator">/</span>tmp<span class="token operator">/</span>ora_delete_archive<span class="token punctuation">.</span>log <span class="token operator">&lt;&lt;</span>EOF
<span class="token keyword">connect</span> target <span class="token operator">/</span>
run {
    <span class="token keyword">delete</span> noprompt archivelog <span class="token keyword">all</span> completed before <span class="token string">&#39;sysdate-30&#39;</span><span class="token punctuation">;</span>
    crosscheck archivelog <span class="token keyword">all</span><span class="token punctuation">;</span>
    <span class="token keyword">delete</span> noprompt expired archivelog <span class="token keyword">all</span><span class="token punctuation">;</span>
}
<span class="token keyword">exit</span><span class="token punctuation">;</span>
EOF
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>查看每小时产生日志的大小</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token comment">------------------------------------------------------------------------------------------------</span>
REM Author: Riyaj Shamsudeen <span class="token variable">@OraInternals</span><span class="token punctuation">,</span> LLC
REM         www<span class="token punctuation">.</span>orainternals<span class="token punctuation">.</span>com
REM
REM Functionality: This script <span class="token operator">is</span> <span class="token keyword">to</span> <span class="token keyword">print</span> redo size rates <span class="token operator">in</span> a RAC claster
REM <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
REM
REM Source  : AWR <span class="token keyword">tables</span>
REM
REM Exectution <span class="token keyword">type</span>: <span class="token keyword">Execute</span> <span class="token keyword">from</span> sqlplus <span class="token operator">or</span> <span class="token keyword">any</span> other tool<span class="token punctuation">.</span>
REM
REM Parameters: <span class="token keyword">No</span> parameters<span class="token punctuation">.</span> Uses <span class="token keyword">Last</span> <span class="token keyword">snapshot</span> <span class="token operator">and</span> the one prior snap
REM <span class="token keyword">No</span> implied <span class="token operator">or</span> explicit warranty
REM
REM Please send me an email <span class="token keyword">to</span> rshamsud<span class="token variable">@orainternals.com</span><span class="token punctuation">,</span> <span class="token keyword">if</span> you enhance this script :<span class="token operator">-</span><span class="token punctuation">)</span>
REM  This <span class="token operator">is</span> a <span class="token keyword">open</span> Source code <span class="token operator">and</span> it <span class="token operator">is</span> free <span class="token keyword">to</span> <span class="token keyword">use</span> <span class="token operator">and</span> <span class="token keyword">modify</span><span class="token punctuation">.</span>
REM Version <span class="token number">1.20</span>
REM
<span class="token comment">------------------------------------------------------------------------------------------------</span>
 
<span class="token keyword">set</span> colsep <span class="token string">&#39;|&#39;</span>
<span class="token keyword">set</span> <span class="token keyword">lines</span> <span class="token number">220</span>
<span class="token keyword">alter</span> <span class="token keyword">session</span> <span class="token keyword">set</span> nls_date_format<span class="token operator">=</span><span class="token string">&#39;YYYY-MM-DD HH24:MI&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">set</span> pagesize <span class="token number">10000</span>
<span class="token keyword">with</span> redo_data <span class="token keyword">as</span> <span class="token punctuation">(</span>
<span class="token keyword">SELECT</span> instance_number<span class="token punctuation">,</span>
       to_date<span class="token punctuation">(</span>to_char<span class="token punctuation">(</span>redo_date<span class="token punctuation">,</span><span class="token string">&#39;DD-MON-YY-HH24:MI&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;DD-MON-YY-HH24:MI&#39;</span><span class="token punctuation">)</span> redo_dt<span class="token punctuation">,</span>
       trunc<span class="token punctuation">(</span>redo_size<span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> redo_size_mb
 <span class="token keyword">FROM</span>  <span class="token punctuation">(</span>
  <span class="token keyword">SELECT</span> dbid<span class="token punctuation">,</span> instance_number<span class="token punctuation">,</span> redo_date<span class="token punctuation">,</span> redo_size <span class="token punctuation">,</span> startup_time  <span class="token keyword">FROM</span>  <span class="token punctuation">(</span>
    <span class="token keyword">SELECT</span>  sysst<span class="token punctuation">.</span>dbid<span class="token punctuation">,</span>sysst<span class="token punctuation">.</span>instance_number<span class="token punctuation">,</span> begin_interval_time redo_date<span class="token punctuation">,</span> startup_time<span class="token punctuation">,</span>
  <span class="token keyword">VALUE</span> <span class="token operator">-</span>
    lag <span class="token punctuation">(</span><span class="token keyword">VALUE</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span>
    <span class="token punctuation">(</span> <span class="token keyword">PARTITION</span> <span class="token keyword">BY</span>  sysst<span class="token punctuation">.</span>dbid<span class="token punctuation">,</span> sysst<span class="token punctuation">.</span>instance_number<span class="token punctuation">,</span> startup_time
      <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> begin_interval_time <span class="token punctuation">,</span>sysst<span class="token punctuation">.</span>instance_number
     <span class="token punctuation">)</span> redo_size
  <span class="token keyword">FROM</span> sys<span class="token punctuation">.</span>wrh$_sysstat sysst <span class="token punctuation">,</span> DBA_HIST_SNAPSHOT snaps
<span class="token keyword">WHERE</span> sysst<span class="token punctuation">.</span>stat_id <span class="token operator">=</span>
       <span class="token punctuation">(</span> <span class="token keyword">SELECT</span> stat_id <span class="token keyword">FROM</span> sys<span class="token punctuation">.</span>wrh$_stat_name <span class="token keyword">WHERE</span>  stat_name<span class="token operator">=</span><span class="token string">&#39;redo size&#39;</span> <span class="token punctuation">)</span>
  <span class="token operator">AND</span> snaps<span class="token punctuation">.</span>snap_id <span class="token operator">=</span> sysst<span class="token punctuation">.</span>snap_id
  <span class="token operator">AND</span> snaps<span class="token punctuation">.</span>dbid <span class="token operator">=</span>sysst<span class="token punctuation">.</span>dbid
  <span class="token operator">AND</span> sysst<span class="token punctuation">.</span>instance_number  <span class="token operator">=</span> snaps<span class="token punctuation">.</span>instance_number
  <span class="token operator">AND</span> snaps<span class="token punctuation">.</span>begin_interval_time<span class="token operator">&gt;</span> sysdate<span class="token operator">-</span><span class="token number">30</span>
   <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> snaps<span class="token punctuation">.</span>snap_id <span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token keyword">select</span>  instance_number<span class="token punctuation">,</span>  redo_dt<span class="token punctuation">,</span> redo_size_mb<span class="token punctuation">,</span>
    <span class="token function">sum</span> <span class="token punctuation">(</span>redo_size_mb<span class="token punctuation">)</span> <span class="token keyword">over</span> <span class="token punctuation">(</span><span class="token keyword">partition</span> <span class="token keyword">by</span>  trunc<span class="token punctuation">(</span>redo_dt<span class="token punctuation">)</span><span class="token punctuation">)</span> total_daily<span class="token punctuation">,</span>
    trunc<span class="token punctuation">(</span><span class="token function">sum</span> <span class="token punctuation">(</span>redo_size_mb<span class="token punctuation">)</span> <span class="token keyword">over</span> <span class="token punctuation">(</span><span class="token keyword">partition</span> <span class="token keyword">by</span>  trunc<span class="token punctuation">(</span>redo_dt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">24</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> hourly_rate
   <span class="token keyword">from</span> redo_Data
<span class="token keyword">order</span> <span class="token keyword">by</span> redo_dt<span class="token punctuation">,</span> instance_number<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>查询某个时段变更最大的对象</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> TO_CHAR<span class="token punctuation">(</span>BEGIN_INTERVAL_TIME<span class="token punctuation">,</span> <span class="token string">&#39;YYYY-MM-DD HH24&#39;</span><span class="token punctuation">)</span> SNAP_TIME<span class="token punctuation">,</span> 
       DHSO<span class="token punctuation">.</span>OBJECT_NAME<span class="token punctuation">,</span> 
       <span class="token function">SUM</span><span class="token punctuation">(</span>DB_BLOCK_CHANGES_DELTA<span class="token punctuation">)</span>                     BLOCK_CHANGED 
<span class="token keyword">FROM</span>   DBA_HIST_SEG_STAT DHSS<span class="token punctuation">,</span> 
       DBA_HIST_SEG_STAT_OBJ DHSO<span class="token punctuation">,</span> 
       DBA_HIST_SNAPSHOT DHS 
<span class="token keyword">WHERE</span>  DHS<span class="token punctuation">.</span>SNAP_ID <span class="token operator">=</span> DHSS<span class="token punctuation">.</span>SNAP_ID 
       <span class="token operator">AND</span> DHS<span class="token punctuation">.</span>INSTANCE_NUMBER <span class="token operator">=</span> DHSS<span class="token punctuation">.</span>INSTANCE_NUMBER 
       <span class="token operator">AND</span> DHSS<span class="token punctuation">.</span>OBJ<span class="token comment"># = DHSO.OBJ# </span>
       <span class="token operator">AND</span> DHSS<span class="token punctuation">.</span>DATAOBJ<span class="token comment"># = DHSO.DATAOBJ# </span>
       <span class="token operator">AND</span> BEGIN_INTERVAL_TIME <span class="token operator">BETWEEN</span> TO_DATE<span class="token punctuation">(</span><span class="token string">&#39;2024-05-14 07:00&#39;</span><span class="token punctuation">,</span> 
                                       <span class="token string">&#39;YYYY-MM-DD HH24:MI&#39;</span><span class="token punctuation">)</span> 
                                       <span class="token operator">AND</span> 
           TO_DATE<span class="token punctuation">(</span><span class="token string">&#39;2024-05-14 08:00&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;YYYY-MM-DD HH24:MI&#39;</span><span class="token punctuation">)</span> 
<span class="token keyword">GROUP</span>  <span class="token keyword">BY</span> TO_CHAR<span class="token punctuation">(</span>BEGIN_INTERVAL_TIME<span class="token punctuation">,</span> <span class="token string">&#39;YYYY-MM-DD HH24&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
          DHSO<span class="token punctuation">.</span>OBJECT_NAME 
<span class="token keyword">HAVING</span> <span class="token function">SUM</span><span class="token punctuation">(</span>DB_BLOCK_CHANGES_DELTA<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> 
<span class="token keyword">ORDER</span>  <span class="token keyword">BY</span> <span class="token function">SUM</span><span class="token punctuation">(</span>DB_BLOCK_CHANGES_DELTA<span class="token punctuation">)</span> <span class="token keyword">DESC</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>查看造成日志大量增长的SQL</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> TO_CHAR<span class="token punctuation">(</span>BEGIN_INTERVAL_TIME<span class="token punctuation">,</span><span class="token string">&#39;YYYY_MM_DD HH24&#39;</span><span class="token punctuation">)</span> SQLWHEN<span class="token punctuation">,</span>
             DBMS_LOB<span class="token punctuation">.</span>SUBSTR<span class="token punctuation">(</span>SQL_TEXT<span class="token punctuation">,</span><span class="token number">4000</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">SQL</span><span class="token punctuation">,</span>
             DHSS<span class="token punctuation">.</span>INSTANCE_NUMBER INST_ID<span class="token punctuation">,</span>
             DHSS<span class="token punctuation">.</span>SQL_ID<span class="token punctuation">,</span>
             EXECUTIONS_DELTA EXEC_DELTA<span class="token punctuation">,</span>
             ROWS_PROCESSED_DELTA ROWS_PROC_DELTA
<span class="token keyword">FROM</span> DBA_HIST_SQLSTAT DHSS<span class="token punctuation">,</span>
         DBA_HIST_SNAPSHOT DHS<span class="token punctuation">,</span>
         DBA_HIST_SQLTEXT DHST
<span class="token keyword">WHERE</span> UPPER<span class="token punctuation">(</span>DHST<span class="token punctuation">.</span>SQL_TEXT<span class="token punctuation">)</span> <span class="token operator">LIKE</span> <span class="token string">&#39;%RCPSF%&#39;</span>  <span class="token comment">--此处用具体的段对象替换</span>
  <span class="token operator">AND</span> LTRIM<span class="token punctuation">(</span>UPPER<span class="token punctuation">(</span>DHST<span class="token punctuation">.</span>SQL_TEXT<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token operator">LIKE</span> <span class="token string">&#39;SELECT%&#39;</span>
  <span class="token operator">AND</span> DHSS<span class="token punctuation">.</span>SNAP_ID<span class="token operator">=</span>DHS<span class="token punctuation">.</span>SNAP_ID
  <span class="token operator">AND</span> DHSS<span class="token punctuation">.</span>INSTANCE_NUMBER<span class="token operator">=</span>DHS<span class="token punctuation">.</span>INSTANCE_NUMBER
  <span class="token operator">AND</span> DHSS<span class="token punctuation">.</span>SQL_ID<span class="token operator">=</span>DHST<span class="token punctuation">.</span>SQL_ID
  <span class="token operator">AND</span> BEGIN_INTERVAL_TIME <span class="token operator">BETWEEN</span> TO_DATE<span class="token punctuation">(</span><span class="token string">&#39;2024-05-14 07:00&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;YYYY-MM-DD HH24:MI&#39;</span><span class="token punctuation">)</span>
  <span class="token operator">AND</span> TO_DATE<span class="token punctuation">(</span><span class="token string">&#39;2024-05-14 08:00&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;YYYY-MM-DD HH24:MI&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="归档日志清理脚本" tabindex="-1"><a class="header-anchor" href="#归档日志清理脚本"><span>归档日志清理脚本</span></a></h2>`,21),v=n("div",{class:"language-bash line-numbers-mode","data-ext":"sh","data-title":"sh"},[n("pre",{class:"language-bash"},[n("code",null,[n("span",{class:"token shebang important"},"#!/bin/bash"),s(`
`),n("span",{class:"token comment"},"# Function: Backup database by rman"),s(`
`),n("span",{class:"token comment"},"# Usage: crontab on linux/Unix, ie."),s(`
`),n("span",{class:"token comment"},'# root, crontab: 0 0 * * * su - oracle -c  "/opt/dba/scripts/ora_delete_archivelog.sh -i testdb -d 7" > /dev/null 2>&1'),s(`
`),n("span",{class:"token comment"},"# oracle, crontab: 0 0 * * * /home/oracle/dba/scripts/ora_delete_archivelog.sh delarch -i ystwo -d 7 >> /home/oracle/dba/log/scripts.log 2>&1"),s(`
`),n("span",{class:"token comment"},"# Last modfiy: 2023-04-07"),s(`
`),n("span",{class:"token comment"},"# Author: abelit"),s(`


`),n("span",{class:"token comment"},"##################### start user conf #############"),s(`
`),n("span",{class:"token comment"},"# Set oracle environment"),s(`
`),n("span",{class:"token builtin class-name"},"source"),s(` /home/oracle/.bash_profile
`),n("span",{class:"token assign-left variable"},"ORACLE_HOME"),n("span",{class:"token operator"},"="),n("span",{class:"token variable"},"$ORACLE_HOME"),s(`
`),n("span",{class:"token assign-left variable"},"DBA_LOGPATH"),n("span",{class:"token operator"},"="),s(`/home/oracle/dba/logs
`),n("span",{class:"token assign-left variable"},"DBA_SCRIPTPATH"),n("span",{class:"token operator"},"="),s(`/home/oracle/dba/scripts

`),n("span",{class:"token assign-left variable"},"ARCHIVE_SAVE_DAYS"),n("span",{class:"token operator"},"="),n("span",{class:"token number"},"7"),s(`
`),n("span",{class:"token comment"},"#################### end user conf ################"),s(`


`),n("span",{class:"token comment"},"##################### start auto preparing ##############"),s(`
`),n("span",{class:"token comment"},"# TODAY"),s(`
`),n("span",{class:"token assign-left variable"},"RUNNING_TIME"),n("span",{class:"token operator"},"="),n("span",{class:"token variable"},[n("span",{class:"token variable"},"`"),n("span",{class:"token function"},"date"),s(),n("span",{class:"token string"},'"+%Y%m%d%H"'),n("span",{class:"token variable"},"`")]),s(`
`),n("span",{class:"token assign-left variable"},"ORACLE_SID"),n("span",{class:"token operator"},"="),s(`testdb

`),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"["),s(),n("span",{class:"token operator"},"!"),s(),n("span",{class:"token parameter variable"},"-d"),s(),n("span",{class:"token string"},[s('"'),n("span",{class:"token variable"},"$DBA_LOGPATH"),s('"')]),s(),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token keyword"},"then"),s(`
	`),n("span",{class:"token function"},"mkdir"),s(),n("span",{class:"token parameter variable"},"-p"),s(),n("span",{class:"token string"},[s('"'),n("span",{class:"token variable"},"$DBA_LOGPATH"),s('"')]),s(`
`),n("span",{class:"token keyword"},"fi"),s(`

`),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"["),s(),n("span",{class:"token operator"},"!"),s(),n("span",{class:"token parameter variable"},"-d"),s(),n("span",{class:"token string"},[s('"'),n("span",{class:"token variable"},"$DBA_SCRIPTPATH"),s('"')]),s(),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token keyword"},"then"),s(`
	`),n("span",{class:"token function"},"mkdir"),s(),n("span",{class:"token parameter variable"},"-p"),s(),n("span",{class:"token string"},[s('"'),n("span",{class:"token variable"},"$DBA_SCRIPTPATH"),s('"')]),s(`
`),n("span",{class:"token keyword"},"fi"),s(`

`),n("span",{class:"token comment"},`# ( printf -- '0 4 8-14 * *  test $(date +\\%u) -eq 7 && echo "2nd Sunday"' ) | crontab`),s(`
`),n("span",{class:"token assign-left variable"},"DELETEARCH_CRONTAB_ENTRY"),n("span",{class:"token operator"},"="),n("span",{class:"token string"},[s(`"0 0 * * * sh -c '`),n("span",{class:"token variable"},[n("span",{class:"token variable"},"`"),n("span",{class:"token builtin class-name"},"pwd"),n("span",{class:"token variable"},"`")]),s("/"),n("span",{class:"token variable"},[n("span",{class:"token variable"},"`"),n("span",{class:"token builtin class-name"},"echo"),s(),n("span",{class:"token string"},[s('"'),n("span",{class:"token variable"},"$0"),s('"')]),s(),n("span",{class:"token operator"},"|"),n("span",{class:"token function"},"sed"),s(),n("span",{class:"token string"},"'s#./##g'"),n("span",{class:"token variable"},"`")]),s(" delarch -i "),n("span",{class:"token variable"},"$ORACLE_SID"),s(" -d "),n("span",{class:"token variable"},"$ARCHIVE_SAVE_DAYS"),s("' >> "),n("span",{class:"token variable"},"$DBA_LOGPATH"),s('/scripts.log 2>&1"')]),s(`
`),n("span",{class:"token comment"},"##################### end auto preparing ##############"),s(`
`),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function-name function"},"delete_options_usage"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token function"},"cat"),s(),n("span",{class:"token operator"},"<<"),n("span",{class:"token string"},[s(`EOF
Usage: `),n("span",{class:"token variable"},"$0"),s(` -h|--helpUsage, help message.
       `),n("span",{class:"token variable"},"$0"),s(` -d|--days, archvielog saving policy.
       `),n("span",{class:"token variable"},"$0"),s(` -i|--instance, oracle database instance.
EOF`)]),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function-name function"},"delete_options"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"while"),s(),n("span",{class:"token punctuation"},"["),s(),n("span",{class:"token variable"},[s("${"),n("span",{class:"token operator"},"#"),s("}")]),s(),n("span",{class:"token parameter variable"},"-gt"),s(),n("span",{class:"token number"},"0"),s(),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token keyword"},"do"),s(`
        `),n("span",{class:"token assign-left variable"},"error_message"),n("span",{class:"token operator"},"="),n("span",{class:"token string"},[s(`"Error: a value is needed for '`),n("span",{class:"token variable"},"$1"),s(`'"`)]),s(`
        `),n("span",{class:"token keyword"},"case"),s(),n("span",{class:"token variable"},"$1"),s(),n("span",{class:"token keyword"},"in"),s(`
        `),n("span",{class:"token parameter variable"},"-d"),s(),n("span",{class:"token operator"},"|"),s(" --days"),n("span",{class:"token punctuation"},")"),s(`
            `),n("span",{class:"token assign-left variable"},"ARCHIVE_SAVE_DAYS"),n("span",{class:"token operator"},"="),n("span",{class:"token variable"},[s("${2"),n("span",{class:"token operator"},":?"),s("$error_message}")]),s(`
            `),n("span",{class:"token builtin class-name"},"shift"),s(),n("span",{class:"token number"},"2"),s(`
            `),n("span",{class:"token punctuation"},";"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token parameter variable"},"-i"),s(),n("span",{class:"token operator"},"|"),s(" --instance"),n("span",{class:"token punctuation"},")"),s(`
            `),n("span",{class:"token assign-left variable"},"ORACLE_SID"),n("span",{class:"token operator"},"="),n("span",{class:"token variable"},[s("${2"),n("span",{class:"token operator"},":?"),s("$error_message}")]),s(`
            `),n("span",{class:"token builtin class-name"},"shift"),s(),n("span",{class:"token number"},"2"),s(`
            `),n("span",{class:"token punctuation"},";"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token parameter variable"},"-h"),s(),n("span",{class:"token operator"},"|"),s(" --help"),n("span",{class:"token punctuation"},")"),s(`
            delete_options_usage
            `),n("span",{class:"token builtin class-name"},"shift"),s(),n("span",{class:"token number"},"2"),s(`
            `),n("span",{class:"token builtin class-name"},"break"),s(`
            `),n("span",{class:"token punctuation"},";"),n("span",{class:"token punctuation"},";"),s(`
        *`),n("span",{class:"token punctuation"},")"),s(`
            `),n("span",{class:"token builtin class-name"},"echo"),s(),n("span",{class:"token string"},[s('"unknown option '),n("span",{class:"token variable"},"$1"),s('"')]),s(`
            `),n("span",{class:"token builtin class-name"},"break"),s(`
            `),n("span",{class:"token punctuation"},";"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token keyword"},"esac"),s(`
    `),n("span",{class:"token keyword"},"done"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function-name function"},"delete_archivelog"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
delete_options `),n("span",{class:"token string"},[s('"'),n("span",{class:"token variable"},"$@"),s('"')]),s(`

`),n("span",{class:"token builtin class-name"},"echo"),s(),n("span",{class:"token parameter variable"},"-e"),s(" This will delete archivelog completed before "),n("span",{class:"token string"},[s('"'),n("span",{class:"token entity",title:"\\033"},"\\033"),s("[31m "),n("span",{class:"token variable"},"$ARCHIVE_SAVE_DAYS"),s(),n("span",{class:"token entity",title:"\\033"},"\\033"),s('[0m"')]),s(" days of oracle instance "),n("span",{class:"token string"},[s('"'),n("span",{class:"token entity",title:"\\033"},"\\033"),s("[31m "),n("span",{class:"token variable"},"$ORACLE_SID"),s(),n("span",{class:"token entity",title:"\\033"},"\\033"),s('[0m"')]),s(),n("span",{class:"token punctuation"},".."),s(`.

`),n("span",{class:"token variable"},"$ORACLE_HOME"),s("/bin/rman "),n("span",{class:"token assign-left variable"},"log"),n("span",{class:"token operator"},"="),n("span",{class:"token variable"},"$DBA_LOGPATH"),s("/ora_delete_archive.log "),n("span",{class:"token operator"},"<<"),n("span",{class:"token string"},[s(`EOF
connect target /
run {
    delete noprompt archivelog all completed before 'sysdate-`),n("span",{class:"token variable"},"$ARCHIVE_SAVE_DAYS"),s(`';
    crosscheck archivelog all;
    delete noprompt expired archivelog all;
}
exit;
EOF`)]),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function-name function"},"add_crontab"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token assign-left variable"},"cron_entry"),n("span",{class:"token operator"},"="),n("span",{class:"token variable"},[n("span",{class:"token variable"},"$("),n("span",{class:"token function"},"crontab"),s(),n("span",{class:"token parameter variable"},"-l"),n("span",{class:"token variable"},")")]),s(`
    `),n("span",{class:"token assign-left variable"},"is_in_cron"),n("span",{class:"token operator"},"="),n("span",{class:"token variable"},[n("span",{class:"token variable"},"`"),n("span",{class:"token builtin class-name"},"pwd"),n("span",{class:"token variable"},"`")]),s("/"),n("span",{class:"token variable"},[n("span",{class:"token variable"},"`"),n("span",{class:"token builtin class-name"},"echo"),s(),n("span",{class:"token string"},[s('"'),n("span",{class:"token variable"},"$0"),s('"')]),s(),n("span",{class:"token operator"},"|"),n("span",{class:"token function"},"sed"),s(),n("span",{class:"token string"},"'s#./##g'"),n("span",{class:"token variable"},"`")]),s(`

    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"["),s(),n("span",{class:"token variable"},"$cron_entry"),s(),n("span",{class:"token operator"},"!="),s(" *"),n("span",{class:"token string"},[s('"'),n("span",{class:"token variable"},"$is_in_cron"),s('"')]),s("* "),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token keyword"},"then"),s(`
        `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"["),s(),n("span",{class:"token variable"},"$cron_entry"),s(),n("span",{class:"token operator"},"!="),s(),n("span",{class:"token string"},'""'),s(),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token keyword"},"then"),s(`
            `),n("span",{class:"token builtin class-name"},"printf"),s(),n("span",{class:"token string"},"'%s\\n'"),s(),n("span",{class:"token string"},[s('"'),n("span",{class:"token variable"},"$cron_entry"),s('"')]),s(),n("span",{class:"token string"},[s('"'),n("span",{class:"token variable"},"$DELETEARCH_CRONTAB_ENTRY"),s('"')]),s(),n("span",{class:"token operator"},"|"),s(),n("span",{class:"token function"},"crontab"),s(` -
        `),n("span",{class:"token keyword"},"else"),s(`
            `),n("span",{class:"token builtin class-name"},"printf"),s(),n("span",{class:"token string"},"'%s\\n'"),s(),n("span",{class:"token string"},[s('"'),n("span",{class:"token variable"},"$DELETEARCH_CRONTAB_ENTRY"),s('"')]),s(),n("span",{class:"token operator"},"|"),s(),n("span",{class:"token function"},"crontab"),s(` -
        `),n("span",{class:"token keyword"},"fi"),s(`
    `),n("span",{class:"token keyword"},"fi"),s(`

    `),n("span",{class:"token builtin class-name"},"echo"),s(),n("span",{class:"token parameter variable"},"-e"),s(" Adding "),n("span",{class:"token string"},[s('"'),n("span",{class:"token entity",title:"\\033"},"\\033"),s("[31m "),n("span",{class:"token variable"},"$DELETEARCH_CRONTAB_ENTRY"),s(),n("span",{class:"token entity",title:"\\033"},"\\033"),s('[0m"')]),s(" to "),n("span",{class:"token function"},"crontab"),s(" successfully"),n("span",{class:"token operator"},"!"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`


`),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function-name function"},"Usage"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token function"},"cat"),s(),n("span",{class:"token operator"},"<<"),n("span",{class:"token string"},[s(`EOF
Usage: `),n("span",{class:"token variable"},"$0"),s(` <subcommand> [option]
    subcommand:
       help, help message.
       delarch, delete archive log
       addcron, add it to crontab
EOF`)]),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function-name function"},"main"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token variable"},[n("span",{class:"token punctuation"},"(("),s("${#} "),n("span",{class:"token operator"},"=="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},"))")]),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token keyword"},"then"),s(`
        Usage `),n("span",{class:"token number"},"0"),s(`
        `),n("span",{class:"token builtin class-name"},"exit"),s(),n("span",{class:"token number"},"1"),s(`
    `),n("span",{class:"token keyword"},"fi"),s(`

    `),n("span",{class:"token keyword"},"case"),s(),n("span",{class:"token variable"},"${1}"),s(),n("span",{class:"token keyword"},"in"),s(`
    `),n("span",{class:"token builtin class-name"},"help"),n("span",{class:"token punctuation"},")"),s(`
        Usage
        `),n("span",{class:"token punctuation"},";"),n("span",{class:"token punctuation"},";"),s(`
    delarch`),n("span",{class:"token punctuation"},")"),s(`
        `),n("span",{class:"token builtin class-name"},"echo"),s(),n("span",{class:"token string"},'"staring deleting archivelog ..."'),s(),n("span",{class:"token operator"},">>"),s(),n("span",{class:"token variable"},"$DBA_LOGPATH"),s(`/ora_delete_archive.log
        `),n("span",{class:"token assign-left variable"},"STARTTIME"),n("span",{class:"token operator"},"="),n("span",{class:"token variable"},[n("span",{class:"token variable"},"$("),n("span",{class:"token function"},"date"),s(" +%s"),n("span",{class:"token variable"},")")]),s(`
        delete_archivelog `),n("span",{class:"token string"},[s('"'),n("span",{class:"token variable"},[s("${@"),n("span",{class:"token operator"},":"),s("2}")]),s('"')]),s(`
        `),n("span",{class:"token assign-left variable"},"ENDTIME"),n("span",{class:"token operator"},"="),n("span",{class:"token variable"},[n("span",{class:"token variable"},"$("),n("span",{class:"token function"},"date"),s(" +%s"),n("span",{class:"token variable"},")")]),s(`
        `),n("span",{class:"token builtin class-name"},"echo"),s(),n("span",{class:"token string"},[s('"end deleting archivelog: $[ '),n("span",{class:"token variable"},"$ENDTIME"),s(" - "),n("span",{class:"token variable"},"$STARTTIME"),s(' ] s"')]),s(),n("span",{class:"token operator"},">>"),s(),n("span",{class:"token variable"},"$DBA_LOGPATH"),s(`/ora_delete_archive.log
        `),n("span",{class:"token punctuation"},";"),n("span",{class:"token punctuation"},";"),s(`
    addcron`),n("span",{class:"token punctuation"},")"),s(`
        add_crontab
        `),n("span",{class:"token punctuation"},";"),n("span",{class:"token punctuation"},";"),s(`
    *`),n("span",{class:"token punctuation"},")"),s(`
        `),n("span",{class:"token builtin class-name"},"echo"),s(),n("span",{class:"token string"},[s('"unknown command: '),n("span",{class:"token variable"},"$1"),s('"')]),s(`
        Usage
        `),n("span",{class:"token builtin class-name"},"exit"),s(),n("span",{class:"token number"},"1"),s(`
        `),n("span",{class:"token punctuation"},";"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"esac"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`


main `),n("span",{class:"token string"},[s('"'),n("span",{class:"token variable"},"$@"),s('"')]),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),b=n("div",{class:"language-bash line-numbers-mode","data-ext":"sh","data-title":"sh"},[n("pre",{class:"language-bash"},[n("code",null,[n("span",{class:"token shebang important"},"#!/bin/bash"),s(`
`),n("span",{class:"token comment"},"# Description: Backup database by rman"),s(`
`),n("span",{class:"token comment"},"# Usage: crontab on linux/Unix, ie."),s(`
`),n("span",{class:"token comment"},'# 0 0 * * * su - oracle -c  "/opt/dba/scripts/ora_delete_archivelog.sh -i orcl -d 30" > /dev/null 2>&1'),s(`
`),n("span",{class:"token comment"},"# 0 0 * * * /opt/dba/scripts/ora_delete_archivelog.sh -i orcl -d 30 > /dev/null 2>&1"),s(`
`),n("span",{class:"token comment"},"# Last modfiy: 2023-04-07"),s(`
`),n("span",{class:"token comment"},"# Author: abelit"),s(`


`),n("span",{class:"token comment"},"##################### start user conf #############"),s(`
`),n("span",{class:"token comment"},"# Set oracle environment"),s(`
`),n("span",{class:"token comment"},"# source /home/oracle/.bash_profile"),s(`
`),n("span",{class:"token assign-left variable"},"ORACLE_HOME"),n("span",{class:"token operator"},"="),n("span",{class:"token variable"},"$ORACLE_HOME"),s(`
`),n("span",{class:"token assign-left variable"},"DBA_LOGPATH"),n("span",{class:"token operator"},"="),s(`/opt/dba/logs
`),n("span",{class:"token assign-left variable"},"DBA_SCRIPTPATH"),n("span",{class:"token operator"},"="),s(`/opt/dba/scripts
`),n("span",{class:"token comment"},"#################### end user conf ################"),s(`


`),n("span",{class:"token comment"},"##################### start auto preparing ##############"),s(`
`),n("span",{class:"token comment"},"# TODAY"),s(`
`),n("span",{class:"token assign-left variable"},"RUNNING_TIME"),n("span",{class:"token operator"},"="),n("span",{class:"token variable"},[n("span",{class:"token variable"},"`"),n("span",{class:"token function"},"date"),s(),n("span",{class:"token string"},'"+%Y%m%d%H"'),n("span",{class:"token variable"},"`")]),s(`
`),n("span",{class:"token assign-left variable"},"ORACLE_SID"),n("span",{class:"token operator"},"="),s(`testdb
`),n("span",{class:"token assign-left variable"},"ARCHIVE_SAVE_DAYS"),n("span",{class:"token operator"},"="),n("span",{class:"token number"},"7"),s(`

`),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"["),s(),n("span",{class:"token operator"},"!"),s(),n("span",{class:"token parameter variable"},"-d"),s(),n("span",{class:"token string"},[s('"'),n("span",{class:"token variable"},"$DBA_LOGPATH"),s('"')]),s(),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token keyword"},"then"),s(`
	`),n("span",{class:"token function"},"mkdir"),s(),n("span",{class:"token parameter variable"},"-p"),s(),n("span",{class:"token string"},[s('"'),n("span",{class:"token variable"},"$DBA_LOGPATH"),s('"')]),s(`
`),n("span",{class:"token keyword"},"fi"),s(`

`),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"["),s(),n("span",{class:"token operator"},"!"),s(),n("span",{class:"token parameter variable"},"-d"),s(),n("span",{class:"token string"},[s('"'),n("span",{class:"token variable"},"$DBA_SCRIPTPATH"),s('"')]),s(),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token keyword"},"then"),s(`
	`),n("span",{class:"token function"},"mkdir"),s(),n("span",{class:"token parameter variable"},"-p"),s(),n("span",{class:"token string"},[s('"'),n("span",{class:"token variable"},"$DBA_SCRIPTPATH"),s('"')]),s(`
`),n("span",{class:"token keyword"},"fi"),s(`
`),n("span",{class:"token comment"},"##################### end auto preparing ##############"),s(`


`),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function-name function"},"delete_options_usage"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token function"},"cat"),s(),n("span",{class:"token operator"},"<<"),n("span",{class:"token string"},[s(`EOF
Usage: `),n("span",{class:"token variable"},"$0"),s(` -h|--helpUsage, help message.
       `),n("span",{class:"token variable"},"$0"),s(` -d|--days, archvielog saving policy.
       `),n("span",{class:"token variable"},"$0"),s(` -i|--instance, oracle database instance.
EOF`)]),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function-name function"},"delete_options"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"while"),s(),n("span",{class:"token punctuation"},"["),s(),n("span",{class:"token variable"},[s("${"),n("span",{class:"token operator"},"#"),s("}")]),s(),n("span",{class:"token parameter variable"},"-gt"),s(),n("span",{class:"token number"},"0"),s(),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token keyword"},"do"),s(`
        `),n("span",{class:"token assign-left variable"},"error_message"),n("span",{class:"token operator"},"="),n("span",{class:"token string"},[s(`"Error: a value is needed for '`),n("span",{class:"token variable"},"$1"),s(`'"`)]),s(`
        `),n("span",{class:"token keyword"},"case"),s(),n("span",{class:"token variable"},"$1"),s(),n("span",{class:"token keyword"},"in"),s(`
        `),n("span",{class:"token parameter variable"},"-d"),s(),n("span",{class:"token operator"},"|"),s(" --days"),n("span",{class:"token punctuation"},")"),s(`
            `),n("span",{class:"token assign-left variable"},"ARCHIVE_SAVE_DAYS"),n("span",{class:"token operator"},"="),n("span",{class:"token variable"},[s("${2"),n("span",{class:"token operator"},":?"),s("$error_message}")]),s(`
            `),n("span",{class:"token builtin class-name"},"shift"),s(),n("span",{class:"token number"},"2"),s(`
            `),n("span",{class:"token punctuation"},";"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token parameter variable"},"-i"),s(),n("span",{class:"token operator"},"|"),s(" --instance"),n("span",{class:"token punctuation"},")"),s(`
            `),n("span",{class:"token assign-left variable"},"ORACLE_SID"),n("span",{class:"token operator"},"="),n("span",{class:"token variable"},[s("${2"),n("span",{class:"token operator"},":?"),s("$error_message}")]),s(`
            `),n("span",{class:"token builtin class-name"},"shift"),s(),n("span",{class:"token number"},"2"),s(`
            `),n("span",{class:"token punctuation"},";"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token parameter variable"},"-h"),s(),n("span",{class:"token operator"},"|"),s(" --help"),n("span",{class:"token punctuation"},")"),s(`
            delete_options_usage
            `),n("span",{class:"token builtin class-name"},"shift"),s(),n("span",{class:"token number"},"2"),s(`
            `),n("span",{class:"token builtin class-name"},"break"),s(`
            `),n("span",{class:"token punctuation"},";"),n("span",{class:"token punctuation"},";"),s(`
        *`),n("span",{class:"token punctuation"},")"),s(`
            `),n("span",{class:"token builtin class-name"},"echo"),s(),n("span",{class:"token string"},[s('"unknown option '),n("span",{class:"token variable"},"$1"),s('"')]),s(`
            `),n("span",{class:"token builtin class-name"},"break"),s(`
            `),n("span",{class:"token punctuation"},";"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token keyword"},"esac"),s(`
    `),n("span",{class:"token keyword"},"done"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function-name function"},"delete_archivelog"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
delete_options `),n("span",{class:"token string"},[s('"'),n("span",{class:"token variable"},"$@"),s('"')]),s(`

`),n("span",{class:"token builtin class-name"},"echo"),s(),n("span",{class:"token parameter variable"},"-e"),s(" This will delete archivelog completed before "),n("span",{class:"token string"},[s('"'),n("span",{class:"token entity",title:"\\033"},"\\033"),s("[31m "),n("span",{class:"token variable"},"$ARCHIVE_SAVE_DAYS"),s(),n("span",{class:"token entity",title:"\\033"},"\\033"),s('[0m"')]),s(" days of oracle instance "),n("span",{class:"token string"},[s('"'),n("span",{class:"token entity",title:"\\033"},"\\033"),s("[31m "),n("span",{class:"token variable"},"$ORACLE_SID"),s(),n("span",{class:"token entity",title:"\\033"},"\\033"),s('[0m"')]),s(),n("span",{class:"token punctuation"},".."),s(`.

`),n("span",{class:"token variable"},"$ORACLE_HOME"),s("/bin/rman "),n("span",{class:"token assign-left variable"},"log"),n("span",{class:"token operator"},"="),n("span",{class:"token variable"},"$DBA_LOGPATH"),s("/ora_delete_archive.log "),n("span",{class:"token operator"},"<<"),n("span",{class:"token string"},[s(`EOF
connect target /
run {
    delete noprompt archivelog all completed before 'sysdate-`),n("span",{class:"token variable"},"$ARCHIVE_SAVE_DAYS"),s(`';
    crosscheck archivelog all;
    delete noprompt expired archivelog all;
}
exit;
EOF`)]),s(`
`),n("span",{class:"token punctuation"},"}"),s(`


`),n("span",{class:"token builtin class-name"},"echo"),s(),n("span",{class:"token string"},[s('"'),n("span",{class:"token variable"},[n("span",{class:"token variable"},"`"),n("span",{class:"token function"},"date"),s(" +%Y%m%d"),n("span",{class:"token variable"},"`")]),s(' staring deleting archivelog ..."')]),s(),n("span",{class:"token operator"},">>"),s(),n("span",{class:"token variable"},"$DBA_LOGPATH"),s(`/ora_delete_archive.log
`),n("span",{class:"token assign-left variable"},"STARTTIME"),n("span",{class:"token operator"},"="),n("span",{class:"token variable"},[n("span",{class:"token variable"},"$("),n("span",{class:"token function"},"date"),s(" +%s"),n("span",{class:"token variable"},")")]),s(`
delete_archivelog `),n("span",{class:"token string"},[s('"'),n("span",{class:"token variable"},[s("${@"),n("span",{class:"token operator"},":"),s("1}")]),s('"')]),s(`
`),n("span",{class:"token assign-left variable"},"ENDTIME"),n("span",{class:"token operator"},"="),n("span",{class:"token variable"},[n("span",{class:"token variable"},"$("),n("span",{class:"token function"},"date"),s(" +%s"),n("span",{class:"token variable"},")")]),s(`
`),n("span",{class:"token builtin class-name"},"echo"),s(),n("span",{class:"token string"},[s('"'),n("span",{class:"token variable"},[n("span",{class:"token variable"},"`"),n("span",{class:"token function"},"date"),s(" +%Y%m%d"),n("span",{class:"token variable"},"`")]),s(" end deleting archivelog: $[ "),n("span",{class:"token variable"},"$ENDTIME"),s(" - "),n("span",{class:"token variable"},"$STARTTIME"),s(' ] s"')]),s(),n("span",{class:"token operator"},">>"),s(),n("span",{class:"token variable"},"$DBA_LOGPATH"),s(`/ora_delete_archive.log
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1);function m(_,g){const p=c("CodeTabs");return l(),i("div",null,[d,u(p,{id:"79",data:[{id:"带crontab版本"},{id:"简化版"}],active:0},{title0:a(({value:t,isActive:e})=>[s("带crontab版本")]),title1:a(({value:t,isActive:e})=>[s("简化版")]),tab0:a(({value:t,isActive:e})=>[v]),tab1:a(({value:t,isActive:e})=>[b]),_:1})])}const A=o(r,[["render",m],["__file","archivelog.html.vue"]]),y=JSON.parse('{"path":"/guide/database/oracle/log/archivelog.html","title":"归档日志","lang":"zh-CN","frontmatter":{"title":"归档日志","description":"日志查询 日志切换数量查询 按日期汇总每天的归档日志数量 按小时汇总当天的归档日志数量 产生大量日志的SQL追踪 每天redo log的切换次数 每小时日志切换次数 归档日志清理 清理日志 查看每小时产生日志的大小 查询某个时段变更最大的对象 查看造成日志大量增长的SQL 归档日志清理脚本","head":[["meta",{"property":"og:url","content":"https://github.com/abelit/abelit-datapeacock.git/guide/database/oracle/log/archivelog.html"}],["meta",{"property":"og:site_name","content":"数之雀"}],["meta",{"property":"og:title","content":"归档日志"}],["meta",{"property":"og:description","content":"日志查询 日志切换数量查询 按日期汇总每天的归档日志数量 按小时汇总当天的归档日志数量 产生大量日志的SQL追踪 每天redo log的切换次数 每小时日志切换次数 归档日志清理 清理日志 查看每小时产生日志的大小 查询某个时段变更最大的对象 查看造成日志大量增长的SQL 归档日志清理脚本"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-08-03T08:57:34.000Z"}],["meta",{"property":"article:author","content":"Abelit"}],["meta",{"property":"article:modified_time","content":"2024-08-03T08:57:34.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"归档日志\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-08-03T08:57:34.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Abelit\\",\\"url\\":\\"https://github.com/abelit\\"}]}"]]},"headers":[{"level":2,"title":"日志查询","slug":"日志查询","link":"#日志查询","children":[{"level":3,"title":"日志切换数量查询","slug":"日志切换数量查询","link":"#日志切换数量查询","children":[]},{"level":3,"title":"产生大量日志的SQL追踪","slug":"产生大量日志的sql追踪","link":"#产生大量日志的sql追踪","children":[]}]},{"level":2,"title":"归档日志清理","slug":"归档日志清理","link":"#归档日志清理","children":[]},{"level":2,"title":"归档日志清理脚本","slug":"归档日志清理脚本","link":"#归档日志清理脚本","children":[]}],"git":{"createdTime":1722675454000,"updatedTime":1722675454000,"contributors":[{"name":"abelit","email":"ychenid@live.com","commits":1}]},"readingTime":{"minutes":5.46,"words":1639},"filePathRelative":"guide/database/oracle/log/archivelog.md","localizedDate":"2024年8月3日","autoDesc":true,"excerpt":"<h2>日志查询</h2>\\n<h3>日志切换数量查询</h3>\\n<ul>\\n<li>按日期汇总每天的归档日志数量</li>\\n</ul>\\n<div class=\\"language-sql\\" data-ext=\\"sql\\" data-title=\\"sql\\"><pre class=\\"language-sql\\"><code><span class=\\"token keyword\\">SELECT</span> TRUNC<span class=\\"token punctuation\\">(</span>completion_time<span class=\\"token punctuation\\">)</span> <span class=\\"token keyword\\">AS</span> <span class=\\"token string\\">\\"日期\\"</span><span class=\\"token punctuation\\">,</span>\\n       <span class=\\"token function\\">COUNT</span><span class=\\"token punctuation\\">(</span><span class=\\"token operator\\">*</span><span class=\\"token punctuation\\">)</span> <span class=\\"token keyword\\">AS</span> <span class=\\"token string\\">\\"数量\\"</span><span class=\\"token punctuation\\">,</span>\\n       <span class=\\"token function\\">ROUND</span><span class=\\"token punctuation\\">(</span><span class=\\"token function\\">SUM</span><span class=\\"token punctuation\\">(</span>blocks <span class=\\"token operator\\">*</span> block_size<span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">/</span> <span class=\\"token number\\">1024</span> <span class=\\"token operator\\">/</span> <span class=\\"token number\\">1024</span><span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">2</span><span class=\\"token punctuation\\">)</span> <span class=\\"token keyword\\">AS</span> <span class=\\"token string\\">\\"MB\\"</span>\\n<span class=\\"token keyword\\">FROM</span> v$archived_log\\n<span class=\\"token keyword\\">GROUP</span> <span class=\\"token keyword\\">BY</span> TRUNC<span class=\\"token punctuation\\">(</span>completion_time<span class=\\"token punctuation\\">)</span>\\n<span class=\\"token keyword\\">ORDER</span> <span class=\\"token keyword\\">BY</span> TRUNC<span class=\\"token punctuation\\">(</span>completion_time<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n</code></pre></div>"}');export{A as comp,y as data};
